const protocol="https:"===window.location.protocol?"wss":"ws";var websocket,gateway=`${protocol}://${window.location.hostname}/ws`;function initWebSocket(){(websocket=new WebSocket(gateway)).onclose=onClose}function onClose(e){console.log("Connection closed"),setTimeout(initWebSocket,2e3)}const Colors={WHITE:1,BLACK:0},canvas=document.getElementById("canvas"),guide=document.getElementById("guide"),clearButton=document.getElementById("clearButton"),brushSizeSelector=document.getElementById("brush-select"),drawingContext=canvas.getContext("2d"),eraserToggle=document.getElementById("eraserToggleCheckbox"),canvasMultiplier=7;canvas.width=896,canvas.height=448;let scaleFactor=1,realWidth=128/scaleFactor,realHeight=64/scaleFactor,cellLength=canvas.width/realWidth,cellHeight=canvas.height/realHeight,eraserOn=!1,isDrawing=!1;function setupGuides(){let e=guide.querySelectorAll("div");e.forEach(e=>e.remove()),guide.style.width=`${canvas.width}px`,guide.style.height=`${canvas.height}px`,guide.style.gridTemplateColumns=`repeat(${realWidth}, 1fr)`,guide.style.gridTemplateRows=`repeat(${realHeight}, 1fr)`;for(let t=0;t<realWidth*realHeight;t++)guide.insertAdjacentHTML("beforeend","<div></div>")}function fillCell(e,t){try{eraserOn?(drawingContext.fillStyle="#242526",websocket.send(e/7+";"+t/7+";"+scaleFactor+";"+Colors.BLACK+";0")):(drawingContext.fillStyle="#FFFFFF",websocket.send(e/7+";"+t/7+";"+scaleFactor+";"+Colors.WHITE+";0"))}catch(a){console.log(a)}drawingContext.fillRect(e,t,cellLength,cellHeight)}function mouseMoved(e){if(isDrawing){let t=canvas.getBoundingClientRect(),a=e.clientX-t.left,n=e.clientY-t.top,l=Math.floor(a/cellLength)*cellLength,o=Math.floor(n/cellHeight)*cellHeight;fillCell(l,o)}}function clearCanvas(){let e=confirm("Are you sure you wish to clear the canvas?");if(e){drawingContext.fillStyle="#242526",drawingContext.fillRect(0,0,canvas.width,canvas.height);try{websocket.send("0;0;0;0;1")}catch(t){console.log(t)}}}function mouseDown(e){isDrawing=!0,mouseMoved(e)}function mouseUp(e){isDrawing=!1}function brushChanged(e){realWidth=128/(scaleFactor=parseInt(e.target.value)),realHeight=64/scaleFactor,cellLength=canvas.width/realWidth,cellHeight=canvas.height/realHeight,setupGuides()}function eraserToggled(e){eraserOn=!eraserOn}drawingContext.fillStyle="#242526",drawingContext.fillRect(0,0,canvas.width,canvas.height),initWebSocket(),setupGuides(),canvas.addEventListener("mousemove",mouseMoved),canvas.addEventListener("mousedown",mouseDown),canvas.addEventListener("mouseup",mouseUp),canvas.addEventListener("mouseout",mouseUp),brushSizeSelector.addEventListener("change",brushChanged),eraserToggle.addEventListener("change",eraserToggled),clearButton.addEventListener("click",clearCanvas);