let websocket;let protocol="https:"===window.location.protocol?"wss":"ws",gateway=`${protocol}://${window.location.hostname}/ws`;function initWebSocket(){(websocket=new WebSocket(gateway)).onclose=onClose,websocket.onMessage=onMessage}function onClose(e){console.log("Connection closed"),setTimeout(initWebSocket,2e3)}function onMessage(e){if(e.data.includes(";")){let t=e.data.split(";"),n=parseInt(t[0]),a=parseInt(t[1]),l=parseInt(t[2]),i=parseInt(t[3]),o=canvas.width/(physicalDisplayWidth/l),s=canvas.height/(physicalDisplayHeight/l);drawingContext.fillStyle="#23a9f2",drawingContext.fillRect(n,a,o,s),i==Colors.BLACK?drawingContext.fillStyle="#242526":i==Colors.WHITE&&(drawingContext.fillStyle="#FFFFFF"),setTimeout(drawingContext.fillRect(n,a,o,s),500)}else if("CC"==e.data)drawingContext.fillStyle="#242526",drawingContext.fillRect(0,0,canvas.width,canvas.height);else{let t=0;for(let n=0;n<physicalDisplayWidth;n++)for(let a=0;a<physicalDisplayHeight;a++){let l=parseInt(e.data[t++]);l==Colors.BLACK?drawingContext.fillStyle="#242526":l==Colors.WHITE&&(drawingContext.fillStyle="#FFFFFF"),drawingContext.fillRect(a,n,1,1)}}}let Colors={WHITE:1,BLACK:0},canvas=document.getElementById("canvas"),guide=document.getElementById("guide"),clearButton=document.getElementById("clearButton"),brushSizeSelector=document.getElementById("brush-select"),drawingContext=canvas.getContext("2d"),eraserToggle=document.getElementById("eraserToggleCheckbox"),canvasMultiplier=7;canvas.width=896,canvas.height=448;let scaleFactor=1,physicalDisplayWidth=128,physicalDisplayHeight=64,widthCount=physicalDisplayWidth/scaleFactor,heightCount=physicalDisplayHeight/scaleFactor,cellLength=canvas.width/widthCount,cellHeight=canvas.height/heightCount,eraserOn=!1,isDrawing=!1;function setupGuides(){guide.querySelectorAll("div").forEach(e=>e.remove()),guide.style.width=`${canvas.width}px`,guide.style.height=`${canvas.height}px`,guide.style.gridTemplateColumns=`repeat(${widthCount}, 1fr)`,guide.style.gridTemplateRows=`repeat(${heightCount}, 1fr)`;for(let e=0;e<widthCount*heightCount;e++)guide.insertAdjacentHTML("beforeend","<div></div>")}function fillCell(e,t){try{eraserOn?(drawingContext.fillStyle="#242526",websocket.send(e/7+";"+t/7+";"+scaleFactor+";"+Colors.BLACK+";0")):(drawingContext.fillStyle="#FFFFFF",websocket.send(e/7+";"+t/7+";"+scaleFactor+";"+Colors.WHITE+";0"))}catch(e){console.log(e)}drawingContext.fillRect(e,t,cellLength,cellHeight)}function mouseMoved(e){if(isDrawing){let t=canvas.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top;fillCell(Math.floor(n/cellLength)*cellLength,Math.floor(a/cellHeight)*cellHeight)}}function clearCanvas(){if(confirm("Are you sure you wish to clear the canvas?")){drawingContext.fillStyle="#242526",drawingContext.fillRect(0,0,canvas.width,canvas.height);try{websocket.send("0;0;0;0;1")}catch(e){console.log(e)}}}function mouseDown(e){isDrawing=!0,mouseMoved(e)}function mouseUp(e){isDrawing=!1}function brushChanged(e){widthCount=128/(scaleFactor=parseInt(e.target.value)),heightCount=64/scaleFactor,cellLength=canvas.width/widthCount,cellHeight=canvas.height/heightCount,setupGuides()}function eraserToggled(e){eraserOn=!eraserOn}drawingContext.fillStyle="#242526",drawingContext.fillRect(0,0,canvas.width,canvas.height),setupGuides(),initWebSocket(),canvas.addEventListener("mousemove",mouseMoved),canvas.addEventListener("mousedown",mouseDown),canvas.addEventListener("mouseup",mouseUp),canvas.addEventListener("mouseout",mouseUp),brushSizeSelector.addEventListener("change",brushChanged),eraserToggle.addEventListener("change",eraserToggled),clearButton.addEventListener("click",clearCanvas);